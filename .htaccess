# Enable URL Rewriting
<IfModule mod_rewrite.c>
    RewriteEngine On
    # RewriteBase /

    # Exclude API folder from rewriting (API calls need .php extension)
    RewriteCond %{REQUEST_URI} ^/api/ [NC]
    RewriteRule ^ - [L]

    # Remove .php extension
    # If the request is not for a directory
    RewriteCond %{REQUEST_FILENAME} !-d
    # If the request is not for a file
    RewriteCond %{REQUEST_FILENAME} !-f
    # If a .php file with the requested name exists
    RewriteCond %{REQUEST_FILENAME}.php -f
    # Rewrite to add .php extension
    RewriteRule ^(.+)$ $1.php [L,QSA]

    # Remove trailing slash from URLs
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^(.*)/$ /$1 [L,R=301]

    # Remove .php extension from URL if present (but not in API folder)
    RewriteCond %{THE_REQUEST} ^[A-Z]{3,}\s([^.]+)\.php [NC]
    RewriteCond %{REQUEST_URI} !^/api/ [NC]
    RewriteRule ^ %1 [R=301,L]
</IfModule>

# Prevent directory browsing
Options -Indexes

# Custom error pages (optional)
# ErrorDocument 404 /404.php

# Security Headers
<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "SAMEORIGIN"
    Header set X-XSS-Protection "1; mode=block"
</IfModule>

# Protect config files
<FilesMatch "^(composer\.(json|lock)|\.git.*|\.env)$">
    Order allow,deny
    Deny from all
</FilesMatch>
